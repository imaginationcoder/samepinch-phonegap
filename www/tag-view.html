<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="">
    <link rel="icon" href="favicon.ico">
    <title>SamePinch</title>
    <!-- Bootstrap core CSS -->
    <link href="css/bootstrap.min.css" rel="stylesheet">
    <!-- Custom styles for this template -->
    <link href="css/style.css" rel="stylesheet">
    <link href="css/jasny-bootstrap.css" rel="stylesheet">
    <link href='http://fonts.googleapis.com/css?family=Ubuntu:300,400' rel='stylesheet' type='text/css'>
    <link href='http://fortawesome.github.io/Font-Awesome/assets/font-awesome/css/font-awesome.css' rel='stylesheet' type='text/css'>
</head>
<body>
<div class="loading-box">
    <div class="sp-spinner"><i class="fa fa-spinner fa-spin"></i></div>
</div>
<div id="Tagview-page">
    <nav class="navbar navbar-inverse navbar-fixed-top navbar-sp">
        <div class="container">
            <div class="row">
                <div class="col-md-3 col-xs-3" onclick="window.history.back();">
                    <span class="glyphicon glyphicon-menu-left back"></span>
                </div>
                <div class="col-md-6 col-xs-6 heading">TAG VIEW</div>
                <div class="col-md-3 col-xs-3 nopadding-left">
                    <a href="#" class="pull-right add-post">
                        <img src="img/icon-createpost.png"  width="26" height="26" alt="" onmouseover="this.src='img/icon-createpost-active.png' " onmouseout="this.src='img/icon-createpost.png'"/>
                    </a>
                </div>
            </div>
        </div>
    </nav>
    <div class="clearfix"></div>
    <div class="container-fluid" id="Tagview">
        <div class="row">
            <div class="profile-box">
                <div class="container txt-center">
                    <!--<div class="profilepic-placeholder">JD</div>-->
                    <div class="tag-img" id="tag-image">

                    </div>
                    <button class="btn-normal mtop15" id="tag-name"></button>
                </div>
            </div>
        </div>
    </div>

    <div class="container load-up-posts" style="display: none;">
        <div class="row">
            <div class="row">
                <div class="sp-spinner"><i class="fa fa-spinner fa-spin"></i></div>
            </div>
        </div>
    </div>

    <div class="container mtop20 mbottom10">
        <div class="row">
            <div class="col-md-12 posts-list" id="Wall">

            </div>
        </div>
    </div>


</div>


<script id="posts-template" type="text/x-handlebars-template">
    {{#posts}}
    <div class="wall-post-box-wrap single-post" id="post-{{ uid }}" data-uid="{{ uid }}">
        <div class="wall-post-box">
            <!-- user picture section -->
            {{#if anonymous}}
            <div class="profile-pic-wrap profilepic-placeholder profile-avatar anonymous">
                <img width="30" height="23" alt="" src="img/ananymous-placeholder.png">
            </div>
            {{else}}
            {{#if owner.photo }}
            <div class="profile-pic-wrap profilepic-img profile-avatar">
                <img alt="" src="{{ owner.photo }}">
            </div>
            {{else}}
            <div class="profile-pic-wrap profilepic-placeholder profile-avatar">{{firstChar owner.fname}}{{firstChar owner.lname}}</div>
            {{/if}}
            {{/if}}
            <div class="profile-name pull-left mleft50 mtop5">
                {{#if anonymous}}
                anonymous
                {{ else }}
                {{ owner.fname }} {{owner.lname}}
                {{/if}}
            </div>
            <!--END -- user picture section -->
            <div class="pull-right mtop5 icon-counts">
                <img src="img/icon-view-count.png" width="26" height="15" alt=""/>
                <span class="mright5">{{ views }}</span>
                <img src="img/icon-upvote-gray.png" width="21" height="21" alt=""/>
                <span class="mright5">{{ upvote_count }}</span>
                <img src="img/time.png" width="20" height="20" alt=""/>
                <span class="mright5 time-style">TD</span> </div>
            <div class="clearfix"></div>
            <div class="post-content mleft50">
                <p>
                    {{ content }}
                </p>
                {{#if image }}
                <img src="{{ image }}"/>
                {{/if }}
            </div>
            <hr>
            <ul class="tags">
                {{#each tags}}
                <li class="single-tag" data-name="{{ this }}">{{ this }}</li>
                {{/each}}
            </ul>
            <div class="clearfix"></div>
            <ul class="comments">
                {{#each commenters}}
                <li><img src="{{ this }}" /></li>
                {{/each}}
                <li>
                    <div class="comment-bubble-count">{{ comment_count }}</div>
                </li>
            </ul>
        </div>
    </div>
    {{/posts}}

</script>


<script type="text/javascript" src="cordova.js"></script>
<script type="text/javascript" src="js/index.js"></script>
<script type="text/javascript" src="js/jquery-2.1.4.min.js"></script>
<script type="text/javascript" src="js/jquery.serialize-hash.js"></script>
<script type="text/javascript" src="js/bootstrap.min.js"></script>
<script type="text/javascript" src="js/jasny-bootstrap.js"></script>
<script type="text/javascript" src="js/bootbox.min.js"></script>
<script type="text/javascript" src="js/handlebars-v3.0.3.js"></script>
<script type="text/javascript" src="js/handlebars-helpers.js"></script>
<script type="text/javascript" src="js/fastclick.js"></script>
<script type="text/javascript" src="js/api_calls.js"></script><!--must before application.js  -->
<script type="text/javascript" src="js/application.js"></script>
<script type="text/javascript" src="js/authentication.js"></script>
<script type="text/javascript" src="js/posts.js"></script>

<script>
    //set tag name
    $('#Tagview-page .add-post').on('click',function(e){
        e.preventDefault();
        if(localStorage['current_user']){
            window.location.href = 'add-post.html'
        }else{
            window.location.href = 'signin.html'
        }
    })


    $('#Tagview-page #tag-name').html(sessionStorage['tag_name'])
    $.ajax({
        url: window.api_url+'posts',
        type: 'post',
        data: {
            'command' :"filter",
            'access_token':  localStorage['access_token'],
            'body': {
                "post_count": 0,
                "last_modified":"",
                "step":"",//# next or new
                "etag":"",
                "key": sessionStorage['tag_name'].substring(1), // remove first char(#)
                "by": 'tag'
            }
        },
        beforeSend: function () {
            $('.load-up-posts').show()
        },
        success: function (data) {
            var source = $("#posts-template").html();
            var template = Handlebars.compile(source);
            body = data.body
            //set tag image
            tag_img = $('<img>')
            tag_img.attr('src',body.tag.image)
            $('#Tagview-page #tag-image').html(tag_img)
            $('.posts-list').prepend(template(body));
            $('.load-up-posts').hide()
            singlePostClickEvents() // enable js for single post click
        },
        error: function(xhr,textStatus,errorThrown ) {
            var error_obj = $.parseJSON(xhr.responseText)
            console.log(error_obj)
            errorDialog('Error',error_obj.message)
            $('.load-up-posts').hide()
        }
    })
</script>
</body>
</html>
