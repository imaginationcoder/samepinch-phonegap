<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="">
    <link rel="icon" href="favicon.ico">
    <title>SamePinch</title>
    <link href="css/bootstrap.min.css" rel="stylesheet">
    <link href="css/style.css" rel="stylesheet">
    <!--<link href="css/jasny-bootstrap.css" rel="stylesheet">-->
    <link href='http://fonts.googleapis.com/css?family=Ubuntu:300,400' rel='stylesheet' type='text/css'>
    <link href='http://fortawesome.github.io/Font-Awesome/assets/font-awesome/css/font-awesome.css' rel='stylesheet' type='text/css'>
</head>
<body>

<div id="Profile-page">
    <nav class="navbar navbar-inverse navbar-fixed-top navbar-sp">
        <div class="container">
            <div class="row">
                <div class="col-md-3 col-xs-3">
                    <a href="#" onclick="window.history.back();"> <span class="glyphicon glyphicon-menu-left back"></span> </a>
                </div>
                <div class="col-md-6 col-xs-6 heading">PROFILE</div>
                <div class="col-md-3 col-xs-3 nopadding-left">
                </div>
            </div>
        </div>
    </nav>

    <div class="clearfix"></div>
    <div class="container-fluid" id="Profile">
        <div class="row">
            <div class="profile-box">
                <div class="container txt-center">
                    <span id="profile-pic-image">
                        <!--<div class="profilepic-placeholder">JD</div>-->
                        <div class="profilepic-img">
                            <img src="img/profile-img.png" alt=""/>
                        </div>
                    </span>

                    <div class="profile-name-profile"></div>
                    <button class="btn-normal">follow</button>
                </div>
            </div>
        </div>
    </div>

    <div class="container load-up-posts" style="display: none;">
        <div class="row">
            <div class="row">
                <div class="sp-spinner"><i class="fa fa-spinner fa-spin"></i></div>
            </div>
        </div>
    </div>

    <div class="container mtop20 mbottom10">
        <div class="row">
            <div class="col-md-12 posts-list" id="Wall">

            </div>
        </div>
    </div>

</div>


<script id="posts-template" type="text/x-handlebars-template">
    {{#posts}}
    <div class="wall-post-box-wrap single-post" id="post-{{ uid }}" data-uid="{{ uid }}">
        <div class="wall-post-box">
            <!-- user picture section -->
            {{#if anonymous}}
            <div class="profile-pic-wrap profilepic-placeholder profile-avatar anonymous">
                <img width="30" height="23" alt="" src="img/ananymous-placeholder.png">
            </div>
            {{else}}
            {{#if owner.photo }}
            <div class="profile-pic-wrap profilepic-img profile-avatar" data-uid="{{ owner.uid }}" data-name="{{ owner.fname}} {{owner.lname}}">
                <img alt="" src="{{ owner.photo }}">
            </div>
            {{else}}
            <div class="profile-pic-wrap profilepic-placeholder profile-avatar" data-uid="{{ owner.uid }}" data-name="{{ owner.fname}} {{owner.lname}}">{{firstChar owner.fname}}{{firstChar owner.lname}}</div>
            {{/if}}
            {{/if}}
            <div class="profile-name pull-left mleft50 mtop5">
                {{#if anonymous}}
                anonymous
                {{ else }}
                {{ owner.fname }} {{owner.lname}}
                {{/if}}
            </div>
            <!--END -- user picture section -->
            <div class="pull-right mtop5 icon-counts">
                <img src="img/icon-view-count.png" width="26" height="15" alt=""/>
                <span class="mright5">{{ views }}</span>
                <img src="img/icon-upvote-gray.png" width="21" height="21" alt=""/>
                <span class="mright5">{{ upvote_count }}</span>
                <img src="img/time.png" width="20" height="20" alt=""/>
                <span class="mright5 time-style">TD</span> </div>
            <div class="clearfix"></div>
            <div class="post-content mleft50">
                <p>
                    {{ content }}
                </p>
                {{#if image }}
                <img src="{{ image }}"/>
                {{/if }}
            </div>
            <hr>
            <ul class="tags">
                {{#each tags}}
                <li class="single-tag" data-name="{{ this }}">{{ this }}</li>
                {{/each}}
            </ul>
            <div class="clearfix"></div>
            <ul class="comments">
                {{#each commenters}}
                <li><img src="{{ this }}" /></li>
                {{/each}}
                <li>
                    <div class="comment-bubble-count">{{ comment_count }}</div>
                </li>
            </ul>
        </div>
    </div>
    {{/posts}}

</script>


<script type="text/javascript" src="cordova.js"></script>
<!--<script type="text/javascript" src="js/index.js"></script>-->
<script type="text/javascript" src="js/jquery-2.1.4.min.js"></script>
<script type="text/javascript" src="js/jquery.serialize-hash.js"></script>
<script type="text/javascript" src="js/bootstrap.min.js"></script>
<!--<script type="text/javascript" src="js/jasny-bootstrap.js"></script>-->
<script type="text/javascript" src="js/bootbox.min.js"></script>
<script type="text/javascript" src="js/handlebars-v3.0.3.js"></script>
<script type="text/javascript" src="js/handlebars-helpers.js"></script>
<script type="text/javascript" src="js/fastclick.js"></script>
<script type="text/javascript" src="js/api_calls.js"></script><!--must before application.js  -->
<!--<script type="text/javascript" src="js/application.js"></script>
<script type="text/javascript" src="js/authentication.js"></script>
-->
<script type="text/javascript" src="js/posts.js"></script>

<script type="text/javascript">
    $('#Profile-page .profile-name-profile').html(sessionStorage['profile_name'])
    // sessionStorage.removeItem('profile_name')

    // get Profile info by uid after that remove from session
    $.ajax({
        url: window.api_url+'users/'+sessionStorage['profile_uid'],
        type: 'post',
        data: {
            'command' : 'public_profile',
            'access_token':  localStorage['access_token'],
        },
        beforeSend: function () { },
        success: function (data) {
            img = ''
            body = data.body
            $('#Profile-page .profile-name-profile').html(body.full_name)
            if(body.photo){
                p_img = $('<img>')
                p_img.attr('src',body.photo)
                img +=  "<div class='profilepic-img'>"
                img +=  '<img src='+ body.photo +' alt=""/>'
                img +=  "</div>"
            } else{
             img += "<div class='profilepic-placeholder'>"
             img +=   body.fname.substr(0, 1).toUpperCase() +""+body.lname.substr(0, 1).toUpperCase()
             img += "</div>"
            }

            $('#Profile-page #profile-pic-image').html(img)
        },
        error: function(xhr,textStatus,errorThrown ) {
            var error_obj = $.parseJSON(xhr.responseText)
            console.log(error_obj)
            hideAjaxSpinner()
            errorDialog('Error',error_obj.message)
        }
    })



    // invoke posts by user
    $.ajax({
        url: window.api_url+'posts',
        type: 'post',
        data: {
            'command' :"filter",
            'access_token':  localStorage['access_token'],
            'body': {
                "post_count": 0,
                "last_modified":"",
                "step":"",//# next or new
                "etag":"",
                "key": sessionStorage['profile_uid'] ,
                "by": 'user'
            }
        },
        beforeSend: function () {
            $('.load-up-posts').show()
        },
        success: function (data) {
            var source = $("#posts-template").html();
            var template = Handlebars.compile(source);
            body = data.body
            $('.posts-list').prepend(template(body));
            $('.load-up-posts').hide()
            singlePostClickEvents() // enable js for single post click
        },
        error: function(xhr,textStatus,errorThrown ) {
            var error_obj = $.parseJSON(xhr.responseText)
            console.log(error_obj)
            errorDialog('Error',error_obj.message)
            $('.load-up-posts').hide()
        }
    })









</script>

</body>
</html>